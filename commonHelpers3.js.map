{"version":3,"file":"commonHelpers3.js","sources":["../src/capitals-weather.js"],"sourcesContent":["// Створи додаток для туристичного агенства. Користувач має форму в яку може додавати довільну кількість полів. В кожне поле він вводить назву країни. Після сабміту фрми форма відправляє запит на бекенд та отримує назви столиць цих країн.\n// На основі відподвіді попереднього сервісу потрібно створити прогноз погоди по кожній столиці. Використовуй паралельні запити. Бекенд для пошуку країн https://restcountries.com/\n// Бекенд для прогнозу погоди https://www.weatherapi.com/docs/\n\nconst elements = {\n  form: document.querySelector('.js-search'),\n  formContainer: document.querySelector('.js-form-container'),\n  addField: document.querySelector('.js-add'),\n  list: document.querySelector('.js-list'),\n};\n\nelements.addField.addEventListener('click', handlerAddField);\nelements.form.addEventListener('submit', handleSubmit);\n\nfunction handlerAddField() {\n  elements.formContainer.insertAdjacentHTML(\n    'beforeend',\n    '<input type=\"text\" class=\"input-country\" name=\"country\" />'\n  );\n}\n\nasync function handleSubmit(event) {\n  event.preventDefault();\n  const formData = new FormData(event.currentTarget);\n  const countries = formData\n    .getAll('country')\n    .map(item => item.trim())\n    .filter(item => item)\n    .filter((item, idx, arr) => arr.indexOf(item) === idx);\n\n  try {\n    const capitals = await servicesCountry(countries);\n    const weather = await serviceWeather(capitals);\n    elements.list.innerHTML = createMarkup(weather);\n  } catch (error) {\n    console.log(error);\n  } finally {\n    elements.formContainer.innerHTML =\n      '<input type=\"text\" class=\"input-country\" name=\"country\" />';\n  }\n}\n\nasync function servicesCountry(countries) {\n  const BASE_URL = 'https://restcountries.com/v3.1/name/';\n  const responses = countries.map(async country => {\n    const resp = await fetch(`${BASE_URL}${country}`);\n    if (!resp.ok) {\n      // throw new Error(resp.statusText);\n      return Promise.reject(resp.statusText);\n    }\n    return resp.json();\n  });\n\n  const data = await Promise.allSettled(responses);\n  return data\n    .filter(({ status }) => status === 'fulfilled')\n    .map(({ value }) => value[0].capital[0]);\n}\n\nasync function serviceWeather(capitals) {\n  const BASE_URL = 'http://api.weatherapi.com/v1/';\n  const END_POINT = 'current.json';\n  const API_KEY = '033b369d9d6241bab00133843241004';\n\n  const responses = capitals.map(async capital => {\n    const params = new URLSearchParams({\n      key: API_KEY,\n      q: capital,\n      lang: 'en',\n    });\n    const resp = await fetch(`${BASE_URL}${END_POINT}?${params}`);\n\n    if (!resp.ok) {\n      return Promise.reject(resp.statusText);\n    }\n    return resp.json();\n  });\n\n  const data = await Promise.allSettled(responses);\n\n  return data\n    .filter(({ status }) => status === 'fulfilled')\n    .map(\n      ({\n        value: {\n          current: {\n            condition: { text, icon },\n            temp_c,\n          },\n          location: { name, country },\n        },\n      }) => {\n        return { text, icon, temp_c, name, country };\n      }\n    );\n}\n\nfunction createMarkup(arr) {\n  return arr\n    .map(\n      ({ country, icon, name, temp_c, text }) => `\n\t<li>\n\t<img src=\"${icon}\" alt=\"${text}\">\n\t<h2>${country}</h2>\n\t<h2>${name}</h2>\n\t<p>${text}</p>\n\t<p>${temp_c} °C</p>\n  </li>\n\t`\n    )\n    .join('');\n}\n"],"names":["elements","handlerAddField","handleSubmit","event","countries","item","idx","arr","capitals","servicesCountry","weather","serviceWeather","createMarkup","error","BASE_URL","responses","country","resp","status","value","END_POINT","API_KEY","capital","params","text","icon","temp_c","name"],"mappings":"wFAIA,MAAMA,EAAW,CACf,KAAM,SAAS,cAAc,YAAY,EACzC,cAAe,SAAS,cAAc,oBAAoB,EAC1D,SAAU,SAAS,cAAc,SAAS,EAC1C,KAAM,SAAS,cAAc,UAAU,CACzC,EAEAA,EAAS,SAAS,iBAAiB,QAASC,CAAe,EAC3DD,EAAS,KAAK,iBAAiB,SAAUE,CAAY,EAErD,SAASD,GAAkB,CACzBD,EAAS,cAAc,mBACrB,YACA,4DACJ,CACA,CAEA,eAAeE,EAAaC,EAAO,CACjCA,EAAM,eAAc,EAEpB,MAAMC,EADW,IAAI,SAASD,EAAM,aAAa,EAE9C,OAAO,SAAS,EAChB,IAAIE,GAAQA,EAAK,MAAM,EACvB,OAAOA,GAAQA,CAAI,EACnB,OAAO,CAACA,EAAMC,EAAKC,IAAQA,EAAI,QAAQF,CAAI,IAAMC,CAAG,EAEvD,GAAI,CACF,MAAME,EAAW,MAAMC,EAAgBL,CAAS,EAC1CM,EAAU,MAAMC,EAAeH,CAAQ,EAC7CR,EAAS,KAAK,UAAYY,EAAaF,CAAO,CAC/C,OAAQG,EAAO,CACd,QAAQ,IAAIA,CAAK,CACrB,QAAY,CACRb,EAAS,cAAc,UACrB,4DACH,CACH,CAEA,eAAeS,EAAgBL,EAAW,CACxC,MAAMU,EAAW,uCACXC,EAAYX,EAAU,IAAI,MAAMY,GAAW,CAC/C,MAAMC,EAAO,MAAM,MAAM,GAAGH,CAAQ,GAAGE,CAAO,EAAE,EAChD,OAAKC,EAAK,GAIHA,EAAK,OAFH,QAAQ,OAAOA,EAAK,UAAU,CAG3C,CAAG,EAGD,OADa,MAAM,QAAQ,WAAWF,CAAS,GAE5C,OAAO,CAAC,CAAE,OAAAG,KAAaA,IAAW,WAAW,EAC7C,IAAI,CAAC,CAAE,MAAAC,KAAYA,EAAM,CAAC,EAAE,QAAQ,CAAC,CAAC,CAC3C,CAEA,eAAeR,EAAeH,EAAU,CACtC,MAAMM,EAAW,gCACXM,EAAY,eACZC,EAAU,kCAEVN,EAAYP,EAAS,IAAI,MAAMc,GAAW,CAC9C,MAAMC,EAAS,IAAI,gBAAgB,CACjC,IAAKF,EACL,EAAGC,EACH,KAAM,IACZ,CAAK,EACKL,EAAO,MAAM,MAAM,GAAGH,CAAQ,GAAGM,CAAS,IAAIG,CAAM,EAAE,EAE5D,OAAKN,EAAK,GAGHA,EAAK,OAFH,QAAQ,OAAOA,EAAK,UAAU,CAG3C,CAAG,EAID,OAFa,MAAM,QAAQ,WAAWF,CAAS,GAG5C,OAAO,CAAC,CAAE,OAAAG,KAAaA,IAAW,WAAW,EAC7C,IACC,CAAC,CACC,MAAO,CACL,QAAS,CACP,UAAW,CAAE,KAAAM,EAAM,KAAAC,CAAM,EACzB,OAAAC,CACD,EACD,SAAU,CAAE,KAAAC,EAAM,QAAAX,CAAS,CAC5B,CACT,KACe,CAAE,KAAAQ,EAAM,KAAAC,EAAM,OAAAC,EAAQ,KAAAC,EAAM,QAAAX,CAAO,EAElD,CACA,CAEA,SAASJ,EAAaL,EAAK,CACzB,OAAOA,EACJ,IACC,CAAC,CAAE,QAAAS,EAAS,KAAAS,EAAM,KAAAE,EAAM,OAAAD,EAAQ,KAAAF,CAAI,IAAO;AAAA;AAAA,aAEpCC,CAAI,UAAUD,CAAI;AAAA,OACxBR,CAAO;AAAA,OACPW,CAAI;AAAA,MACLH,CAAI;AAAA,MACJE,CAAM;AAAA;AAAA,EAGP,EACA,KAAK,EAAE,CACZ"}